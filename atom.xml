<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>心有猛虎，细嗅蔷薇</title>
  
  <subtitle>既然选择了远方，便只顾风雨兼程</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.leesj.cn/"/>
  <updated>2018-07-18T09:20:57.640Z</updated>
  <id>http://www.leesj.cn/</id>
  
  <author>
    <name>timogal</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Jpa执行分页count sql的时机</title>
    <link href="http://www.leesj.cn/archives/jpa-count-sql.html"/>
    <id>http://www.leesj.cn/archives/jpa-count-sql.html</id>
    <published>2018-07-18T17:15:55.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>在使用JPA的时候发现有的时候jpa并没有去执行total的查询语句，但还是返回了<code>totalElements</code>这个字段, 处于好奇，于是查了一波源码.<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.springframework.data.jpa.repository.query.JpaQueryExecution#PagedExecution</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Executes the &#123;<span class="doctag">@link</span> AbstractStringBasedJpaQuery&#125; to return a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.data.domain.Page&#125; of entities.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PagedExecution</span> <span class="keyword">extends</span> <span class="title">JpaQueryExecution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Parameters&lt;?, ?&gt; parameters;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PagedExecution</span><span class="params">(Parameters&lt;?, ?&gt; parameters)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.parameters = parameters;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">doExecute</span><span class="params">(<span class="keyword">final</span> AbstractJpaQuery repositoryQuery, <span class="keyword">final</span> Object[] values)</span> </span>&#123;</span><br><span class="line">ParameterAccessor accessor = <span class="keyword">new</span> ParametersParameterAccessor(parameters, values);</span><br><span class="line">Query query = repositoryQuery.createQuery(values);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> PageableExecutionUtils.getPage(query.getResultList(), accessor.getPageable(),</span><br><span class="line">() -&gt; count(repositoryQuery, values));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">count</span><span class="params">(AbstractJpaQuery repositoryQuery, Object[] values)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">List&lt;?&gt; totals = repositoryQuery.createCountQuery(values).getResultList();</span><br><span class="line"><span class="keyword">return</span> (totals.size() == <span class="number">1</span></span><br><span class="line">    ? CONVERSION_SERVICE.convert(totals.get(<span class="number">0</span>), Long.class)</span><br><span class="line">    : totals.size());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上面<code>PagedExecution</code>这个类是用于执行分页查询的Jpa执行器，<code>count</code>方法用于查询总条数，注意到这一行：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PageableExecutionUtils.getPage(query.getResultList(), accessor.getPageable(),</span><br><span class="line">                () -&gt; count(repositoryQuery, values))</span><br></pre></td></tr></table></figure></p><p>第一个参数是查询的结果，第二个是传入的分页参数，第三个参数是<strong>获取总记录条数的方法</strong>，不是直接去查询总条数，我们来看看<code>PageableExecutionUtils.getPage</code>这个方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.springframework.data.repository.support.PageableExecutionUtils</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a &#123;<span class="doctag">@link</span> Page&#125; based on the given &#123;<span class="doctag">@code</span> content&#125;, &#123;<span class="doctag">@link</span> Pageable&#125; and &#123;<span class="doctag">@link</span> Supplier&#125; applying</span></span><br><span class="line"><span class="comment"> * optimizations. The construction of &#123;<span class="doctag">@link</span> Page&#125; omits a count query if the total can be determined based on the</span></span><br><span class="line"><span class="comment"> * result size and &#123;<span class="doctag">@link</span> Pageable&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content must not be &#123;<span class="doctag">@literal</span> null&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageable must not be &#123;<span class="doctag">@literal</span> null&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> totalSupplier must not be &#123;<span class="doctag">@literal</span> null&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the &#123;<span class="doctag">@link</span> Page&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Page&lt;T&gt; <span class="title">getPage</span><span class="params">(List&lt;T&gt; content, Pageable pageable, LongSupplier totalSupplier)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">Assert.notNull(content, <span class="string">"Content must not be null!"</span>);</span><br><span class="line">Assert.notNull(pageable, <span class="string">"Pageable must not be null!"</span>);</span><br><span class="line">Assert.notNull(totalSupplier, <span class="string">"TotalSupplier must not be null!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pageable.isUnpaged() || pageable.getOffset() == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pageable.isUnpaged() || pageable.getPageSize() &gt; content.size()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> PageImpl&lt;&gt;(content, pageable, content.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> PageImpl&lt;&gt;(content, pageable, totalSupplier.getAsLong());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (content.size() != <span class="number">0</span> &amp;&amp; pageable.getPageSize() &gt; content.size()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> PageImpl&lt;&gt;(content, pageable, pageable.getOffset() + content.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> PageImpl&lt;&gt;(content, pageable, totalSupplier.getAsLong());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意看第三个参数<code>totalSupplier</code>(戳此处了解<a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html" target="_blank" rel="noopener">Supplier</a>)的使用时机，就可以知道，以下两种情况下将不会使用<code>totalSupplier</code>：</p><ol><li>没有分页信息</li><li>当前查询结果的记录条数小于pageSize(页大小)</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在使用JPA的时候发现有的时候jpa并没有去执行total的查询语句，但还是返回了&lt;code&gt;totalElements&lt;/code&gt;这个字段, 处于好奇，于是查了一波源码.&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://www.leesj.cn/categories/java/"/>
    
      <category term="spring" scheme="http://www.leesj.cn/categories/java/spring/"/>
    
    
      <category term="spring" scheme="http://www.leesj.cn/tags/spring/"/>
    
      <category term="spring-data-jpa" scheme="http://www.leesj.cn/tags/spring-data-jpa/"/>
    
      <category term="jpa" scheme="http://www.leesj.cn/tags/jpa/"/>
    
  </entry>
  
  <entry>
    <title>记录常用的网站</title>
    <link href="http://www.leesj.cn/archives/useful-websites.html"/>
    <id>http://www.leesj.cn/archives/useful-websites.html</id>
    <published>2018-06-11T18:38:33.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>整理一下常用的网站，以免忘记!</p><a id="more"></a><h3 id="测试图片和视频"><a href="#测试图片和视频" class="headerlink" title="测试图片和视频"></a>测试图片和视频</h3><h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><ul><li><a href="https://placeholder.com/" target="_blank" rel="noopener">https://placeholder.com/</a></li><li><a href="https://placeimg.com/" target="_blank" rel="noopener">https://placeimg.com/</a></li><li><a href="http://ipsumimage.appspot.com/" target="_blank" rel="noopener">http://ipsumimage.appspot.com/</a></li></ul><h4 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h4><ul><li><a href="http://www.sample-videos.com/" target="_blank" rel="noopener">http://www.sample-videos.com/</a></li></ul><h3 id="License"><a href="#License" class="headerlink" title="License"></a>License</h3><ul><li><a href="https://choosealicense.com/" target="_blank" rel="noopener">https://choosealicense.com/</a></li></ul><h3 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h3><ul><li><a href="http://cron.qqe2.com/" target="_blank" rel="noopener">quartz的cron表达式生成</a></li><li><a href="https://caniuse.com/" target="_blank" rel="noopener">浏览器兼容性检查</a></li><li><a href="http://mvnrepository.com/" target="_blank" rel="noopener">maven搜索仓库</a></li><li><a href="https://leetcode.com/problemset/all/" target="_blank" rel="noopener">算法题解</a></li><li><a href="https://leetcode-cn.com/problemset/all/" target="_blank" rel="noopener">算法题解 - 中文</a></li><li><a href="http://www.sjyhome.com/html/html-special-characters.html" target="_blank" rel="noopener">HTML特殊字符大全</a></li><li><a href="http://ngrok.ciqiuwl.cn/" target="_blank" rel="noopener">国内ngrok</a> (请文明使用)</li></ul><h3 id="大神博客"><a href="#大神博客" class="headerlink" title="大神博客"></a>大神博客</h3><ul><li><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">廖雪峰的官方网站</a></li><li><a href="http://www.ruanyifeng.com/blog/" target="_blank" rel="noopener">阮一峰的网络日志</a></li></ul><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul><li><a href="http://screensiz.es/" target="_blank" rel="noopener">各种屏幕尺寸</a></li><li><a href="http://app.xunjiepdf.com/" target="_blank" rel="noopener">文档转换</a></li></ul><p>此文章持续更新…</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;整理一下常用的网站，以免忘记!&lt;/p&gt;
    
    </summary>
    
      <category term="normal" scheme="http://www.leesj.cn/categories/normal/"/>
    
    
      <category term="java" scheme="http://www.leesj.cn/tags/java/"/>
    
      <category term="websites" scheme="http://www.leesj.cn/tags/websites/"/>
    
      <category term="程序员常用网站" scheme="http://www.leesj.cn/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99/"/>
    
  </entry>
  
  <entry>
    <title>记一次clinit产生的NPE</title>
    <link href="http://www.leesj.cn/archives/java-clinit-npe.html"/>
    <id>http://www.leesj.cn/archives/java-clinit-npe.html</id>
    <published>2018-06-06T18:22:46.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>最近在做项目的时候碰到了一个以前未见过的NPE，<a id="more"></a>代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookingState</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BookingState INITIAL = <span class="keyword">new</span> BookingState(<span class="string">"00000"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern VALUE_REGEXP = Pattern.compile(<span class="string">"^-?\\d&#123;5&#125;$"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookingState</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span> || !VALUE_REGEXP.matcher(value).matches()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"invalid value \""</span> + value + <span class="string">"\""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>乍一看，没什么问题，可事实就是在程序启动时报了如下错误：</p><p><img src="https://oi4kggmuk.qnssl.com/images/blog/npe.png" alt=""></p><p>既然存在<code>value == null</code>的判断，就排除了value为空的可能原因，那么我就将注意力放在了<code>&lt;init&gt;</code>和<code>&lt;clinit&gt;</code>上了，通过查找资料，对于init和clinit的定义如下：</p><h4 id="clinit"><a href="#clinit" class="headerlink" title="clinit"></a>clinit</h4><blockquote><p>类”初始化”阶段，它是一个类或接口被首次使用的前阶段中的最后一项工作，本阶段负责为类变量赋予正确的初始值。</p></blockquote><blockquote><p>Java 编译器把所有的类变量初始化语句和类型的静态初始化器通通收集到 <code>&lt;clinit&gt;</code> 方法内，该方法只能被 Jvm 调用，专门承担初始化工作。</p></blockquote><blockquote><p>除接口以外，初始化一个类之前必须保证其直接超类已被初始化，并且该初始化过程是由 Jvm 保证线程安全的。另外，并非所有的类都会拥有一个 <code>&lt;clinit&gt;()</code> 方法，在以下条件中该类不会拥有 <code>&lt;clinit&gt;()</code> 方法：</p></blockquote><blockquote></blockquote><ul><li>该类既没有声明任何类变量，也没有静态初始化语句；</li><li>该类声明了类变量，但没有明确使用类变量初始化语句或静态初始化语句初始化；</li><li>该类仅包含静态<code>final</code>变量的类变量初始化语句，并且类变量初始化语句是编译时常量表达式。</li></ul><h4 id="init"><a href="#init" class="headerlink" title="init"></a>init</h4><blockquote><p>在类被装载、连接和初始化，这个类就随时都可能使用了。对象实例化和初始化是就是对象生命的起始阶段的活动，在这里我们主要讨论对象的初始化工作的相关特点。</p></blockquote><blockquote><p>Java 编译器在编译每个类时都会为该类至少生成一个实例初始化方法–即 <code>&lt;init&gt;()</code> 方法。此方法与源代码中的每个构造方法相对应，如果类没有明确地声明任何构造方法，编译器则为该类生成一个默认的无参构造方法，这个默认的构造器仅仅调用父类的无参构造器，与此同时也会生成一个与默认构造方法对应的 <code>&lt;init&gt;()</code> 方法.</p></blockquote><blockquote><p>通常来说，<code>&lt;init&gt;()</code> 方法内包括的代码内容大概为：调用另一个 <code>&lt;init&gt;()</code> 方法；对实例变量初始化；与其对应的构造方法内的代码。</p></blockquote><blockquote><p>如果构造方法是明确地从调用同一个类中的另一个构造方法开始，那它对应的 <code>&lt;init&gt;()</code> 方法体内包括的内容为：一个对本类的<code>&lt;init&gt;()</code> 方法的调用；对应用构造方法内的所有字节码。</p></blockquote><blockquote><p>如果构造方法不是通过调用自身类的其它构造方法开始，并且该对象不是 Object 对象，那 <code>&lt;init&gt;()</code> 法内则包括的内容为：一个对父类 <code>&lt;init&gt;()</code> 方法的调用；对实例变量初始化方法的字节码；最后是对应构造子的方法体字节码。</p></blockquote><blockquote><p>如果这个类是<code>Object</code>，那么它的<code>&lt;init&gt;()</code>方法则不包括对父类<code>&lt;init&gt;()</code>方法的调用。</p></blockquote><p>明白上面两个方法的作用后，再次检查我们的代码，就会发现问题了，在初始化<code>INITIAL</code>对象时调用了构造方法，而构造方法使用了未初始化的变量<code>VALUE_REGEXP</code>(<code>INITIAL</code>对象在<code>VALUE_REGEXP之前定义</code>)，所以就产生了NPE.</p><p>所以要解决该问题就只需要将<code>VALUE_REGEXP</code>的定义放到<code>INITIAL</code>对象之前。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>产生这个问题的主要原因是对JVM虚拟机不了解，所以以后要多对JVM和JAVA底层进行了解。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://blog.csdn.net/JAVA528416037/article/details/48463639" target="_blank" rel="noopener">java中init()和clinit()方法的区别</a></p><p><a href="https://stackoverflow.com/questions/10325744/java-exceptionininitializererror-caused-by-nullpointerexception-when-constructi" target="_blank" rel="noopener">Java: ExceptionInInitializerError caused by NullPointerException when constructing a Locale object</a></p><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-clobj-init/index.html" target="_blank" rel="noopener">解析 Java 类和对象的初始化过程</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在做项目的时候碰到了一个以前未见过的NPE，
    
    </summary>
    
      <category term="java" scheme="http://www.leesj.cn/categories/java/"/>
    
    
      <category term="java-clinit" scheme="http://www.leesj.cn/tags/java-clinit/"/>
    
      <category term="java-init" scheme="http://www.leesj.cn/tags/java-init/"/>
    
      <category term="npe" scheme="http://www.leesj.cn/tags/npe/"/>
    
  </entry>
  
  <entry>
    <title>docker集成jenkins碰到的问题记录</title>
    <link href="http://www.leesj.cn/archives/docker-jenkins-problems.html"/>
    <id>http://www.leesj.cn/archives/docker-jenkins-problems.html</id>
    <published>2018-05-05T14:40:46.000Z</published>
    <updated>2018-07-18T09:20:57.636Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-docker-command-is-not-found"><a href="#1-docker-command-is-not-found" class="headerlink" title="1. docker command is not found"></a>1. docker command is not found</h3><p>在启动jenkins的时候挂载：</p><ul><li><code>-v /bin/docker:/usr/bin/docker</code></li><li><code>-v /var/run/docker.sock:/var/run/docker.sock</code></li></ul><h3 id="2-libltd-so-7-No-Such-File-…"><a href="#2-libltd-so-7-No-Such-File-…" class="headerlink" title="2. libltd.so.7 No Such File …"></a>2. libltd.so.7 No Such File …</h3><p>类似问题1: <code>-v /lib64/libltd.so.7:/usr/lib/libltd.so.7</code></p><h3 id="3-dial-unix-var-run-docker-sock-connect-permission-denied"><a href="#3-dial-unix-var-run-docker-sock-connect-permission-denied" class="headerlink" title="3. dial unix /var/run/docker.sock: connect: permission denied"></a>3. dial unix /var/run/docker.sock: connect: permission denied</h3><h4 id="方法1-将用户添加到docker用户组"><a href="#方法1-将用户添加到docker用户组" class="headerlink" title="方法1: 将用户添加到docker用户组"></a>方法1: 将用户添加到<code>docker</code>用户组</h4><p><code>sudo usermod -a -G docker ${whoami}</code></p><h4 id="方法2-更改-var-run-docker-sock的权限"><a href="#方法2-更改-var-run-docker-sock的权限" class="headerlink" title="方法2: 更改/var/run/docker.sock的权限"></a>方法2: 更改<code>/var/run/docker.sock</code>的权限</h4><p><code>sudo chmod 777 /var/run/docker.sock</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-docker-command-is-not-found&quot;&gt;&lt;a href=&quot;#1-docker-command-is-not-found&quot; class=&quot;headerlink&quot; title=&quot;1. docker command is not found&quot;&gt;&lt;/
      
    
    </summary>
    
    
      <category term="docker" scheme="http://www.leesj.cn/tags/docker/"/>
    
      <category term="jenkins" scheme="http://www.leesj.cn/tags/jenkins/"/>
    
      <category term="dood" scheme="http://www.leesj.cn/tags/dood/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode题目 ( JAVA解决思路记录 ) - 5.字符串最长回文</title>
    <link href="http://www.leesj.cn/archives/leetcode-5-longest-palindromic.html"/>
    <id>http://www.leesj.cn/archives/leetcode-5-longest-palindromic.html</id>
    <published>2018-04-09T19:18:24.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个字符串 s，找到s中最长的<a href="https://zh.wikipedia.org/wiki/%E5%9B%9E%E6%96%87" target="_blank" rel="noopener">回文</a>子串。你可以假设 s 长度最长为1000。<br><a id="more"></a><br>原题目地址：<a href="https://leetcode.com/problems/add-two-numbers" target="_blank" rel="noopener">https://leetcode.com/problems/longest-palindromic-substring/description/</a></p><p>中文版题目地址：<a href="https://leetcode-cn.com/problems/longest-palindromic-substring/description/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/longest-palindromic-substring/description/</a></p><h3 id="标准答案"><a href="#标准答案" class="headerlink" title="标准答案"></a>标准答案</h3><p>标准答案<a href="https://leetcode.com/problems/longest-palindromic-substring/solution/#approach-4-expand-around-center-accepted" target="_blank" rel="noopener">点此</a>查看</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> start = <span class="number">0</span>, end = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> len1 = expandAroundCenter(s, i, i);</span><br><span class="line">        <span class="keyword">int</span> len2 = expandAroundCenter(s, i, i + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> len = Math.max(len1, len2);</span><br><span class="line">        <span class="keyword">if</span> (len &gt; end - start) &#123;</span><br><span class="line">            start = i - (len - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            end = i + len / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.substring(start, end + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">expandAroundCenter</span><span class="params">(String s, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> L = left, R = right;</span><br><span class="line">    <span class="keyword">while</span> (L &gt;= <span class="number">0</span> &amp;&amp; R &lt; s.length() &amp;&amp; s.charAt(L) == s.charAt(R)) &#123;</span><br><span class="line">        L--;</span><br><span class="line">        R++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R - L - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="答案思路"><a href="#答案思路" class="headerlink" title="答案思路"></a>答案思路</h3><h4 id="第二层循环-expandAroundCenter"><a href="#第二层循环-expandAroundCenter" class="headerlink" title="第二层循环 expandAroundCenter"></a>第二层循环 <code>expandAroundCenter</code></h4><p>以<code>s[left]</code>到<code>s[right]</code>包含的字符串为中心，向左右扩展，寻找相等的字符。<br>若 <code>s[left] == s[right]</code> 则去比较 <code>s[left - 1]</code> 和 <code>s[right + 1]</code>,若相等，重复以上的步骤，若比较到两者不相等，或者到了字符串的头部或尾部，停止比较，找到以 <code>s[left] - s[right]</code>为中心的最长回文。</p><p>可以如下图所示表示：</p><p><img src="https://oi4kggmuk.qnssl.com/images/longest-substring.png" alt=""></p><h4 id="第一层循环"><a href="#第一层循环" class="headerlink" title="第一层循环"></a>第一层循环</h4><p>从第一个字符串开始遍历，每次找到以<code>s[i]</code>和 <code>s[i] - s[i + 1]</code>(长度为奇数和偶数的)为中心的最长回文长度，然后使用其中较长的，再与前次结果相比较，若长度大于前次的，则选取该子串，然后根据中心<code>i/i+1</code>和长度，找到<strong>该最长回文</strong>的起始index和结束index（<code>start/end</code>），循环完成后得出最长子串。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h3&gt;&lt;p&gt;给定一个字符串 s，找到s中最长的&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E5%9B%9E%E6%96%87&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;回文&lt;/a&gt;子串。你可以假设 s 长度最长为1000。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://www.leesj.cn/categories/java/"/>
    
      <category term="Algorithm" scheme="http://www.leesj.cn/categories/java/Algorithm/"/>
    
    
      <category term="leetcode" scheme="http://www.leesj.cn/tags/leetcode/"/>
    
      <category term="longest-palindromic-substring" scheme="http://www.leesj.cn/tags/longest-palindromic-substring/"/>
    
      <category term="java" scheme="http://www.leesj.cn/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>初识Java9模块化系统</title>
    <link href="http://www.leesj.cn/archives/java9-jpms.html"/>
    <id>http://www.leesj.cn/archives/java9-jpms.html</id>
    <published>2018-02-08T14:40:46.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>java9在2017年9月21日正式发布，添加了很多<a href="https://www.ibm.com/developerworks/cn/java/the-new-features-of-Java-9/index.html" target="_blank" rel="noopener">新特性</a>，最让我感兴趣的就是模块系统(JPMS - Java 9 Platform Module System )。</p><a id="more"></a><p>在我的理解下，这个模块系统与<a href="https://zh.wikipedia.org/wiki/OSGi" target="_blank" rel="noopener">OSGi</a>相似，对比OSGi,个人感觉配置比OSGi简单很多（毕竟是集成在JDK中了）</p><h3 id="什么是模块"><a href="#什么是模块" class="headerlink" title="什么是模块"></a>什么是模块</h3><blockquote><p>Modularity adds a higher level of aggregation above packages. The key new language element is the module—a uniquely named, reusable group of related packages, as well as resources (such as images and XML files) and a module descriptor specifying</p></blockquote><blockquote><p>模块化在package上添加了更高层次的聚合, 新的关键字是<code>module</code>: 一个唯一命名的，可重用的相关包组，以及资源（如图像和XML文件）和一个模块描述符</p></blockquote><p>引用自<a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener">Understanding Java 9 Modules</a></p><ul><li><a href="#module-name">the module’s name</a></li><li><a href="#module-dependency">the module’s <em>dependencies</em></a> (that is, other modules this module depends on)</li><li><a href="#module-exports">the packages it explicitly makes available to other modules</a> (all other packages in -     the module are implicitly unavailable to other modules)</li><li><a href="#module-exports">the <em>services it offers</em></a></li><li><a href="#module-consumer">the <em>services it consumes</em></a></li><li>to what other modules it allows reflection</li></ul><h3 id="module-name">the module’s name(模块名称)</h3><p>模块名称是唯一的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* module-info.java */</span></span><br><span class="line"><span class="keyword">module</span> com.example.someModule&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>com.example.someModule</code> 表示模块的名称，用包名区分唯一的（非强制）</p><h3 id="module-dependency">the module’s dependencies(模块的依赖)</h3><p>定义模块依赖了那些模块，未在此定义的模块不能引用（java自带的模块可用 <code>java --list-modules</code> 命令查看）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.someModule&#123;</span><br><span class="line">    <span class="comment">// 引用模块</span></span><br><span class="line">    <span class="keyword">requires</span> com.example.anotherModule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="module-exports">the packages it explicitly makes available to other modules(导出模块的包)</h3><p><code>exports</code> 定义模块中哪些包可以被其他模块所见（即使用）</p><p><code>provides</code> 定义模块提供的服务，服务一般为接口，内部实现不暴露给其他模块</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.somepackage.internal.XXXServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> com.example.someModule&#123;</span><br><span class="line">    <span class="comment">// 导出包</span></span><br><span class="line">    <span class="keyword">exports</span> com.example.somepackage;</span><br><span class="line">    <span class="comment">// 提供服务</span></span><br><span class="line">    provides com.example.somepackage.XXXService with XXXServiceImpl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="module-consumer">the services it consumes(消费服务)</h3><p>定义模块消费的服务，使用 <code>use</code> 定义消费的服务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.someModule&#123;</span><br><span class="line">    <span class="comment">// 引用模块</span></span><br><span class="line">    <span class="keyword">requires</span> com.example.anotherModule;</span><br><span class="line">    <span class="comment">// 引用服务</span></span><br><span class="line">    uses com.example.anotherModule.XXXService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用服务的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ServiceLoader&lt;XXXService&gt; xxxLoader = ServiceLoader.load(XXXService.class);</span><br><span class="line">    Optional&lt;XXXService&gt; xxxInstance = xxxLoader.findFirst();</span><br><span class="line">    <span class="keyword">if</span> (xxxInstance.isPresent()) &#123;</span><br><span class="line">        XXXService xxx = xxxInstance.get();</span><br><span class="line">        xxx.someMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://openjdk.java.net/projects/jigsaw/quick-start" target="_blank" rel="noopener">JPMS快速入门</a>点此</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;java9在2017年9月21日正式发布，添加了很多&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/the-new-features-of-Java-9/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;新特性&lt;/a&gt;，最让我感兴趣的就是模块系统(JPMS - Java 9 Platform Module System )。&lt;/p&gt;
    
    </summary>
    
    
      <category term="java9" scheme="http://www.leesj.cn/tags/java9/"/>
    
      <category term="jpms" scheme="http://www.leesj.cn/tags/jpms/"/>
    
      <category term="模块化" scheme="http://www.leesj.cn/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>React学习笔记 -- 父子组件的通信</title>
    <link href="http://www.leesj.cn/archives/react-parent-children-connection.html"/>
    <id>http://www.leesj.cn/archives/react-parent-children-connection.html</id>
    <published>2017-06-23T19:21:46.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>在前面的章节中我们学习了如何在组件中管理自身的状态，那么问题来了！在实际的开发环境中不可能只有一个组件，那么组件之间进行通信就很关键了，如何通信？我们今天来学习父子组件间的通信！<br><a id="more"></a><br>在React关于Component<a href="https://facebook.github.io/react/docs/react-component.html#the-component-lifecycle" target="_blank" rel="noopener">生命周期</a>的介绍中，在Updating中有<strong>componentWillReceiveProps</strong>这样一个状态,它的介绍如下</p><blockquote><p>componentWillReceiveProps() is invoked before a mounted component receives new props. If you need to update the state in response to prop changes (for example, to reset it), you may compare this.props and nextProps and perform state transitions using this.setState() in this method.</p></blockquote><p>大概的意思就是已经处于Mounted状态的组件在收到新的属性（props）之前的时候会调用componentWillReceiveProps这个方法，如果你需要改变状态去响应属性的变化，你可能要比较当前的props和改变的props然后使用在这个方法中使用setState去改变状态。</p><p>需要注意的是如果shouldComponentUpdate返回了false,componentWillReceiveProps、render和componentDidMount方法将不会执行</p><p>下面看例子：</p><h3 id="父组件"><a href="#父组件" class="headerlink" title="父组件"></a>父组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      parentText:<span class="string">'父组件的初始状态'</span>,</span><br><span class="line">      childText:<span class="string">'子组件的初始状态'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.handleParentButtonClick = <span class="keyword">this</span>.handleParentButtonClick.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.handleChildButtonClick = <span class="keyword">this</span>.handleChildButtonClick.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 父组件的按钮点击,改变子组件label的值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleParentButtonClick()&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      childText:<span class="string">'父组件按钮点击，子组件label值改变'</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 子组件的按钮点击，改变父组件label的值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleChildButtonClick()&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      parentText:<span class="string">'子组件按钮点击，父组件label值改变'</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &lt;label&gt;&#123;this.state.parentText&#125;&lt;/label&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.handleParentButtonClick&#125;&gt;父组件按钮点击&lt;/button&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      &lt;Child text=&#123;this.state.childText&#125; handleClick=&#123;this.handleChildButtonClick&#125;  /&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="子组件"><a href="#子组件" class="headerlink" title="子组件"></a>子组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.handleChildClick = <span class="keyword">this</span>.handleChildClick.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleChildClick()&#123;</span><br><span class="line">    <span class="keyword">this</span>.props.handleClick();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;this.props.text&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleChildClick&#125;</span>&gt;</span>子组件按钮点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Child.propTypes = &#123;</span><br><span class="line">  handleClick:React.PropTypes.func,</span><br><span class="line">  text:React.PropTypes.string</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>效果是子组件的按钮点击，父组件的label值改变，父组件的按钮点击，子组件的label改变。这里的关键就是当Child组件的props改变时会重新渲染，子组件的按钮点击实际上调用的是父组件里的方法，即直接改变父组件的状态。<br>#<br>演示地址：<a href="http://codepen.io/lisijie/pen/KNjLBj" target="_blank" rel="noopener">http://codepen.io/lisijie/pen/KNjLBj</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在前面的章节中我们学习了如何在组件中管理自身的状态，那么问题来了！在实际的开发环境中不可能只有一个组件，那么组件之间进行通信就很关键了，如何通信？我们今天来学习父子组件间的通信！&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
      <category term="react类" scheme="http://www.leesj.cn/tags/react%E7%B1%BB/"/>
    
      <category term="react 生命周期" scheme="http://www.leesj.cn/tags/react-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    
      <category term="渲染" scheme="http://www.leesj.cn/tags/%E6%B8%B2%E6%9F%93/"/>
    
      <category term="组件间的通讯" scheme="http://www.leesj.cn/tags/%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E8%AE%AF/"/>
    
      <category term="Parent &amp; Children" scheme="http://www.leesj.cn/tags/Parent-Children/"/>
    
  </entry>
  
  <entry>
    <title>React学习笔记 -- 按条件渲染页面(conditional-rendering)</title>
    <link href="http://www.leesj.cn/archives/react-condition-rendering.html"/>
    <id>http://www.leesj.cn/archives/react-condition-rendering.html</id>
    <published>2017-06-23T19:20:31.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>按条件渲染即指根据不同的条件显示不同的内容,就像下面的例子:<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userGreet = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome back!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line"><span class="keyword">var</span> guestGreet = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Please login First.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Greet</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> isLogin = props.isLogin;</span><br><span class="line">    <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">        <span class="keyword">return</span> userGreet;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> guestGreet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">        &lt;Greet isLogin=&#123;<span class="literal">false</span>&#125;/&gt;,</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'demo7'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>当isLogin为true的时候显示”Welcome back”,false时显示”Plese Login First”,下面的例子通过点击登录、登出按钮模拟不同的isLogin状态下显示的内容</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoginButton</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">            &lt;button onClick=&#123;props.onClick&#125;&gt;登录&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function LogoutButton(props) &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">            &lt;button onClick=&#123;props.onClick&#125;&gt;登出&lt;/</span>button&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginControl</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.loginClick = <span class="keyword">this</span>.loginClick.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.logoutClick = <span class="keyword">this</span>.logoutClick.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">isLogin</span>: <span class="literal">false</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    loginClick() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            isLogin: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    logoutClick() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            isLogin: <span class="literal">false</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> isLogin = <span class="keyword">this</span>.state.isLogin;</span><br><span class="line">        <span class="keyword">let</span> button = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">            button = <span class="xml"><span class="tag">&lt;<span class="name">LogoutButton</span> <span class="attr">onClick</span>=<span class="string">&#123;this.logoutClick&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#125; else &#123;</span></span><br><span class="line">            button = &lt;LoginButton onClick=&#123;this.loginClick&#125;/&gt;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return &lt;div&gt;</span><br><span class="line">            &lt;Greet isLogin=&#123;isLogin&#125;/&gt;</span><br><span class="line">            &#123;button&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在render方法中首先获取当前的登录状态，根据isLogin输出不同文字和不同的按钮。</p><p><img src="http://og1q3elcx.bkt.clouddn.com/react/demo7/should-login.png" alt=""><br><img src="http://og1q3elcx.bkt.clouddn.com/react/demo7/logout.png" alt=""></p><p>在判断的时候可以使用JSX的逻辑运算符<strong>&amp;&amp;</strong>，类似isLogin&amp;&amp;doSomething(),也可使用条件表达式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;isLogin?(&lt;LoginButton onClick=&#123;this.loginClick&#125;/&gt;):(&lt;LoginButton onClick=&#123;this.loginClick&#125;/&gt;)&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="通过条件阻止组件的渲染"><a href="#通过条件阻止组件的渲染" class="headerlink" title="通过条件阻止组件的渲染"></a>通过条件阻止组件的渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WarningBanner</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!props.warning) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Warning!!!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Page</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.showWarning = <span class="keyword">this</span>.showWarning.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            isShow: <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    showWarning() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span>=&gt;</span> (&#123;</span><br><span class="line">            isShow:!prev.isShow</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">                    &lt;WarningBanner warning=&#123;this.state.isShow&#125;/&gt;</span><br><span class="line">                    &lt;button onClick=&#123;this.showWarning&#125;&gt;</span><br><span class="line">                        &#123;this.state.isShow ? "hide" : "show"&#125;</span><br><span class="line">                    &lt;/button&gt;</span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        );</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">ReactDOM.render(</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Page</span> /&gt;</span>,</span></span><br><span class="line"><span class="xml">        document.getElementById('demo7')</span></span><br><span class="line"><span class="xml">);</span></span><br></pre></td></tr></table></figure><p>通过点击show/hide按钮显示和隐藏WarningBanner</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;按条件渲染即指根据不同的条件显示不同的内容,就像下面的例子:&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
      <category term="react类" scheme="http://www.leesj.cn/tags/react%E7%B1%BB/"/>
    
      <category term="react 生命周期" scheme="http://www.leesj.cn/tags/react-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    
      <category term="渲染" scheme="http://www.leesj.cn/tags/%E6%B8%B2%E6%9F%93/"/>
    
      <category term="按条件渲染" scheme="http://www.leesj.cn/tags/%E6%8C%89%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>React学习笔记 -- 属性(props)</title>
    <link href="http://www.leesj.cn/archives/react-props.html"/>
    <id>http://www.leesj.cn/archives/react-props.html</id>
    <published>2017-06-23T19:15:52.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>属性作用于组件上,属性名可以为任意字符串,下面看例子<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Demo4Class = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Demo4Class name=<span class="string">"Jack"</span>/&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"demo4"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>运行结果:<br><img src="http://og1q3elcx.bkt.clouddn.com/react/simple-result.png" alt=""></p><h3 id="特殊props"><a href="#特殊props" class="headerlink" title="特殊props"></a>特殊props</h3><h3 id="1-children"><a href="#1-children" class="headerlink" title="1.children"></a>1.children</h3><blockquote><p>children是props中的一个特殊属性,表示组件的子节点,下面是例子:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Demo4Class = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                React.Children.map(this.props.children, function (child) &#123;</span></span><br><span class="line"><span class="xml">                    return <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;child&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;)</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">        &lt;Demo4Class&gt;</span><br><span class="line">            &lt;span&gt;Hello,Jack!<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">            &lt;span&gt;Hello,Lily!<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">            &lt;span&gt;Hello,Tiger!<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">        &lt;<span class="regexp">/Demo4Class&gt;,</span></span><br><span class="line"><span class="regexp">        document.getElementById("demo4")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure></p></blockquote><p>运行结果:<br><img src="http://og1q3elcx.bkt.clouddn.com/react/props-children-result.png" alt=""></p><blockquote><p>尝试使用children作为普通属性使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Demo4Class = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Demo4Class children=<span class="string">"Jack"</span>/&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"demo4"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p></blockquote><p>无异常,且正常运行,但是建议在开发中不要使用children作为普通属性,以免混淆</p><h3 id="2-js保留关键字class-for"><a href="#2-js保留关键字class-for" class="headerlink" title="2.js保留关键字class,for"></a>2.js保留关键字class,for</h3><blockquote><p>若作为普通属性,也可正常运行,但也不建议使用这两个甚至于其他html标签的一些属性</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;属性作用于组件上,属性名可以为任意字符串,下面看例子&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
      <category term="react类" scheme="http://www.leesj.cn/tags/react%E7%B1%BB/"/>
    
      <category term="props" scheme="http://www.leesj.cn/tags/props/"/>
    
  </entry>
  
  <entry>
    <title>React学习笔记 -- 状态和生命周期(State and Lifecycle)</title>
    <link href="http://www.leesj.cn/archives/react-lifecycle.html"/>
    <id>http://www.leesj.cn/archives/react-lifecycle.html</id>
    <published>2017-06-23T19:15:52.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<h3 id="尝试使用前面所学的知识去更新UI-大致代码如下"><a href="#尝试使用前面所学的知识去更新UI-大致代码如下" class="headerlink" title="尝试使用前面所学的知识去更新UI,大致代码如下:"></a>尝试使用前面所学的知识去更新UI,大致代码如下:</h3><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showNow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> element = (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">           现在时间是:&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleTimeString()&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    ReactDOM.render(</span></span><br><span class="line"><span class="regexp">        element,</span></span><br><span class="line"><span class="regexp">        document.getElementById('demo5')</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">setInterval(showNow, 1000);</span></span><br></pre></td></tr></table></figure><p>那么每隔一秒就会去刷新当前的时间</p><h3 id="如果我们要让其自动更新时间-而不必去调用setInterval来循环刷新-就用到了state"><a href="#如果我们要让其自动更新时间-而不必去调用setInterval来循环刷新-就用到了state" class="headerlink" title="如果我们要让其自动更新时间,而不必去调用setInterval来循环刷新,就用到了state"></a>如果我们要让其自动更新时间,而不必去调用setInterval来循环刷新,就用到了state</h3><blockquote><p>state与props类似,但state是组件私有的,由组件全权控制</p></blockquote><p>要实现自动更新,就要将showNow由函数改为组件,并且这个组件继承与React.Component,而且这个类要<strong>实现render方法</strong>,<strong>拥有一个构造器</strong>.(是不是与java的类很相似呢!!)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            现在时间是:&#123;this.state.date.toLocaleTimeString()&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Clock/&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'demo5'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>运行后,显示了当前时间,但并没有更新时间,原因是只是给了状态,并没有实现定时更新,也就是下面要说的生命周期:</p><blockquote><p><strong>componentDidMount</strong>表示组件已经输出到DOM<br><strong>componentWillUnmount</strong>表示组件任务完成,即将解除”安装”</p></blockquote><p>据此,在componentDidMount中启动定时器,然后在componentWillUnmount中结束定时器,将Clock改为:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            现在时间是:&#123;this.state.date.toLocaleTimeString()&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    showNow() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.timer = setInterval(</span><br><span class="line">                ()=&gt;<span class="keyword">this</span>.showNow(),</span><br><span class="line">        <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        clearInterval(<span class="keyword">this</span>.timer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>运行结果:每隔一秒就会去刷新当前的时间</p><p>在<a href="https://facebook.github.io/react/docs/state-and-lifecycle.html" target="_blank" rel="noopener">官方文档</a>中需要注意一个地方:</p><p>不要直接去使用this.state.date=something去直接更新state,因为this.props和this.state可能是异步更新的，你不应该依赖它们的值来计算下一个状态。应该使用<strong>setState()</strong>去更新状态</p><h3 id="这些内容很复杂-还得花些时间去消化"><a href="#这些内容很复杂-还得花些时间去消化" class="headerlink" title="这些内容很复杂,还得花些时间去消化!!!"></a>这些内容很复杂,还得花些时间去消化!!!</h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;尝试使用前面所学的知识去更新UI-大致代码如下&quot;&gt;&lt;a href=&quot;#尝试使用前面所学的知识去更新UI-大致代码如下&quot; class=&quot;headerlink&quot; title=&quot;尝试使用前面所学的知识去更新UI,大致代码如下:&quot;&gt;&lt;/a&gt;尝试使用前面所学的知识去更新UI,大致代码如下:&lt;/h3&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
      <category term="react类" scheme="http://www.leesj.cn/tags/react%E7%B1%BB/"/>
    
      <category term="react 生命周期" scheme="http://www.leesj.cn/tags/react-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    
      <category term="组件" scheme="http://www.leesj.cn/tags/%E7%BB%84%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>React学习笔记 -- 属性(props)</title>
    <link href="http://www.leesj.cn/archives/react-prop-types.html"/>
    <id>http://www.leesj.cn/archives/react-prop-types.html</id>
    <published>2017-06-23T19:15:52.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PropTypes是用于验证props的属性类型"><a href="#PropTypes是用于验证props的属性类型" class="headerlink" title="PropTypes是用于验证props的属性类型"></a>PropTypes是用于验证props的属性类型</h2><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Demo5Class = React.createClass(&#123;</span><br><span class="line">    propTypes: &#123;</span><br><span class="line">        name: React.PropTypes.string.isRequired</span><br><span class="line">    &#125;,</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="string">"123"</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Demo5Class name=&#123;num&#125;/&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"demo5"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><p>将num改为数字再试<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">123</span>;</span><br></pre></td></tr></table></figure></p><p>也会正常运行,但在控制台上将会显示如下警告:<br><img src="http://og1q3elcx.bkt.clouddn.com/react/type_error_warning.png" alt=""></p><p>设置默认的属性值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Demo5Class = React.createClass(&#123;</span><br><span class="line">    propTypes: &#123;</span><br><span class="line">        name: React.PropTypes.string.isRequired</span><br><span class="line">    &#125;,</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    getDefaultProps: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            name: <span class="string">"My name is Default"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Demo5Class /&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"demo5"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;PropTypes是用于验证props的属性类型&quot;&gt;&lt;a href=&quot;#PropTypes是用于验证props的属性类型&quot; class=&quot;headerlink&quot; title=&quot;PropTypes是用于验证props的属性类型&quot;&gt;&lt;/a&gt;PropTypes是用于验证props的属性类型&lt;/h2&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
      <category term="react类" scheme="http://www.leesj.cn/tags/react%E7%B1%BB/"/>
    
      <category term="propTypes" scheme="http://www.leesj.cn/tags/propTypes/"/>
    
  </entry>
  
  <entry>
    <title>React学习 -- 类(Class)</title>
    <link href="http://www.leesj.cn/archives/react-class.html"/>
    <id>http://www.leesj.cn/archives/react-class.html</id>
    <published>2017-06-23T19:15:52.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<h3 id="类-即组件-component-可以重复使用的部分"><a href="#类-即组件-component-可以重复使用的部分" class="headerlink" title="类,即组件(component),可以重复使用的部分"></a>类,即组件(component),可以重复使用的部分</h3><p>React使用createClass来创建类,下面是示例<br><a id="more"></a></p><h3 id="step1-创建空的类"><a href="#step1-创建空的类" class="headerlink" title="step1:创建空的类"></a>step1:创建空的类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstClass = React.createClass(&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在浏览器中运行将会报如下错误:<br><img src="http://og1q3elcx.bkt.clouddn.com/react/react_demo3_render_error.png" alt=""><br>意思就是创建类必须实现render方法</p><h3 id="step2-实现render方法"><a href="#step2-实现render方法" class="headerlink" title="step2:实现render方法"></a>step2:实现render方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstClass = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is first components!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>运行正常</p><h3 id="step3-使用组件"><a href="#step3-使用组件" class="headerlink" title="step3:使用组件"></a>step3:使用组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstClass = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is first components!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;firstClass/&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'demo3'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>运行后未报错,也没有显示预期的结果</p><h3 id="step4-将firstClass改为FirstClass"><a href="#step4-将firstClass改为FirstClass" class="headerlink" title="step4:将firstClass改为FirstClass"></a>step4:将firstClass改为FirstClass</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FirstClass = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is first components!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">     &lt;FirstClass /&gt;,</span><br><span class="line">     <span class="built_in">document</span>.getElementById(<span class="string">'demo3'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>运行成功,下面是运行结果:</p><p><img src="http://og1q3elcx.bkt.clouddn.com/react/react_demo3_success.png" alt=""></p><p>原因:React 的 JSX 里约定分别使用首字母大、小写来区分本地组件的类和 HTML 标签。render渲染时，会把大写的组件名定义为自定义组件，把小写的组件名定义为HTML自带的标签名进行渲染。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;类-即组件-component-可以重复使用的部分&quot;&gt;&lt;a href=&quot;#类-即组件-component-可以重复使用的部分&quot; class=&quot;headerlink&quot; title=&quot;类,即组件(component),可以重复使用的部分&quot;&gt;&lt;/a&gt;类,即组件(component),可以重复使用的部分&lt;/h3&gt;&lt;p&gt;React使用createClass来创建类,下面是示例&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
      <category term="react类" scheme="http://www.leesj.cn/tags/react%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>React学习 - JSX语法(js与html混写)</title>
    <link href="http://www.leesj.cn/archives/react-jsx.html"/>
    <id>http://www.leesj.cn/archives/react-jsx.html</id>
    <published>2017-06-23T19:12:34.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>在React中,script的type属性为text/babel,与之前写的text/javascript不同,这个就是JSX,下面看代码<br><a id="more"></a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React第二弹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../react.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../react-dom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../browser.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"demo2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/** example1 **/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> names = [<span class="string">'Alice'</span>, <span class="string">"Tom"</span>, <span class="string">"Lily"</span>];</span></span><br><span class="line"><span class="undefined">    ReactDOM.render(</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined">                &#123;</span></span><br><span class="line"><span class="javascript">                    names.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">// 1.return "name:" + item;</span></span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>name:&#123;item&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="undefined">                    &#125;)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">'demo2'</span>)</span></span><br><span class="line"><span class="undefined">    );</span></span><br><span class="line"><span class="javascript">    <span class="comment">/** example2 **/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> doms = [</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>name:Alice<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>,</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>name:Tom<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>,</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>name:Lily<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    ];</span></span><br><span class="line"><span class="undefined">    ReactDOM.render(</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;doms&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">'demo2'</span>)</span></span><br><span class="line"><span class="undefined">    );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/** example3 **/</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> json = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">"demo1"</span>:<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">"demo2"</span>:<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>JSX语法<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    ReactDOM.render(</span></span><br><span class="line"><span class="undefined">            &#123;json&#125;,</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">'demo2'</span>)</span></span><br><span class="line"><span class="undefined">    );</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="example1"><a href="#example1" class="headerlink" title="example1 :"></a>example1 :</h3><p>例子一中预先定义了普通的JS数组,然后在div块中循环输出,结果如下:</p><p><img src="http://og1q3elcx.bkt.clouddn.com/reactreact-demo2-result.png" alt=""></p><h3 id="example2"><a href="#example2" class="headerlink" title="example2:"></a>example2:</h3><p>例子二中的数组采用JSX定义,然后通过{doms}调用,react内部循环处理,结果与<br>example1相同</p><h3 id="example3"><a href="#example3" class="headerlink" title="example3"></a>example3</h3><p>例子三定义了一个JSX形式的json数据,仿example2进行输出,结果得到如下错误:</p><p><img src="http://og1q3elcx.bkt.clouddn.com/reactreact-json-error.png" alt=""></p><p>错误的大概意思就是”对象不是一个有效的react节点,如果想渲染一个集合,用数组替换或者用createFragment创建”</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在React中,script的type属性为text/babel,与之前写的text/javascript不同,这个就是JSX,下面看代码&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/categories/javascript/react/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="react" scheme="http://www.leesj.cn/tags/react/"/>
    
      <category term="jsx" scheme="http://www.leesj.cn/tags/jsx/"/>
    
  </entry>
  
  <entry>
    <title>javascript使用正则表达式获取路径中的参数</title>
    <link href="http://www.leesj.cn/archives/js-split-url-params.html"/>
    <id>http://www.leesj.cn/archives/js-split-url-params.html</id>
    <published>2017-06-23T19:00:12.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>路径中的参数格式为key1=value1&amp;key2=value2…使用?跟在请求路径上,那么获取参数就可以这样:<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    url = url.split(<span class="string">'?'</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> pairs = url.split(<span class="string">'&amp;'</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;pairs.length;i++)&#123;</span><br><span class="line">        <span class="keyword">var</span> pair = pairs[i];</span><br><span class="line">        <span class="keyword">var</span> values = pair.split(<span class="string">'='</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'key='</span>+values[<span class="number">0</span>] + <span class="string">',value='</span>+values[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>但是不仅用起来麻烦,而且处理起特殊的url有误,使用正则表达式则会避免这些</p><h3 id="获取单个参数"><a href="#获取单个参数" class="headerlink" title="获取单个参数"></a>获取单个参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param name 要取参数的key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getQueryString</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|&amp;)"</span> + name + <span class="string">"=([^&amp;]*)(&amp;|$)"</span>, <span class="string">"i"</span>);</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">window</span>.location.search.substr(<span class="number">1</span>).match(reg);</span><br><span class="line">    <span class="keyword">if</span> (r != <span class="literal">null</span>) <span class="keyword">return</span> <span class="built_in">unescape</span>(r[<span class="number">2</span>]); <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取全部参数"><a href="#获取全部参数" class="headerlink" title="获取全部参数"></a>获取全部参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var params = &#123;&#125;;</span><br><span class="line">function getUrlParams(url) &#123;</span><br><span class="line">    var queryRegExp = new RegExp(&apos;([\\?|&amp;])(.+?)=([^&amp;?]*)&apos;, &apos;ig&apos;);</span><br><span class="line">    var result = queryRegExp.exec(url);</span><br><span class="line">    while (result) &#123;</span><br><span class="line">        console.log(result);</span><br><span class="line">        params[result[2]] = result[3];</span><br><span class="line">        result = queryRegExp.exec(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在queryRegExp中’ig’的含义为不区分大小写,匹配全部<br>为什么选取result[2]和result[3],看result在控制台中的结果:</p><p><img src="http://og1q3elcx.bkt.clouddn.com/javacript/js-get-url-params.png" alt=""></p><p>参考链接:</p><ol><li><a href="http://www.netingcn.com/url-get-parameter-value.html" target="_blank" rel="noopener">http://www.netingcn.com/url-get-parameter-value.html</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;路径中的参数格式为key1=value1&amp;amp;key2=value2…使用?跟在请求路径上,那么获取参数就可以这样:&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.leesj.cn/categories/javascript/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="正则表达式" scheme="http://www.leesj.cn/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
      <category term="获取url的参数" scheme="http://www.leesj.cn/tags/%E8%8E%B7%E5%8F%96url%E7%9A%84%E5%8F%82%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>生成简单的图形验证码（下）--  在页面中展示验证码</title>
    <link href="http://www.leesj.cn/archives/simple-captcha-display.html"/>
    <id>http://www.leesj.cn/archives/simple-captcha-display.html</id>
    <published>2017-06-21T19:23:34.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>在上一篇文章<a href="simple-captcha.html">生成简单的图形验证码（上）</a>中已经知道如何生成验证码，这节中我们来学习如何在HTML页面上展示验证码。<br>话不多说，撸代码：<br><a id="more"></a><br>首先尝试使用jquery的ajax:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url:<span class="string">'http://localhost:8080/captcha'</span>,</span><br><span class="line">    type:<span class="string">'get'</span>,</span><br><span class="line">    success:<span class="function"><span class="keyword">function</span>(<span class="params">img</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(img);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>控制台将会打印一串乱码，因为ajax并没有解析img的dataType(大家可以尝试换几种dataType来请求)</p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="方案一："><a href="#方案一：" class="headerlink" title="方案一："></a>方案一：</h4><p>既然在response中设置了返回的类型为<em>image/jpeg</em>，那么将请求验证码的链接作为img的src肯定是没有问题的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;http://localhost:8080/captcha&quot; /&gt;</span><br></pre></td></tr></table></figure><p>成功输出验证码，那么问题来了:浏览器本身是会缓存图片的，img的使用相同的src很大概率会被缓存下来，解决办法就是在链接后面加上随机的参数，如下所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://localhost:8080/captcha"</span> <span class="attr">id</span>=<span class="string">"captcha"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getCaptcha()"</span>&gt;</span>看不清，换一张<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getCaptcha</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'captcha'</span>).src =   <span class="string">'http://localhost:8080/captcha?ver='</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="方案二："><a href="#方案二：" class="headerlink" title="方案二："></a>方案二：</h4><p>使用XMLHttpRequest,使用这个请求将responseType设置为blob(即返回类型为文件)，然后获取Blob的url,赋值给img<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCaptcha</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    XMLHttpRequest xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">'get'</span>, <span class="string">'http://localhost:8080/captcha'</span>, <span class="literal">true</span>);</span><br><span class="line">    xhr.responseType = <span class="string">'blob'</span>;</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> resp = <span class="keyword">this</span>.response;</span><br><span class="line">           <span class="built_in">document</span>.getElementById(<span class="string">'captcha'</span>).src = <span class="built_in">window</span>.URL.createObjectURL(resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="https://segmentfault.com/q/1010000000443286" target="_blank" rel="noopener">ajax请求并处理二进制流(图片)</a></p><p><a href="http://www.zhangxinxu.com/wordpress/2013/10/understand-domstring-document-formdata-blob-file-arraybuffer/" target="_blank" rel="noopener">理解DOMString、Document、FormData、Blob、File、ArrayBuffer数据类型</a></p><p><a href="http://blog.csdn.net/chenghui0317/article/details/12526439" target="_blank" rel="noopener">java web项目生成验证码的解决方案</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在上一篇文章&lt;a href=&quot;simple-captcha.html&quot;&gt;生成简单的图形验证码（上）&lt;/a&gt;中已经知道如何生成验证码，这节中我们来学习如何在HTML页面上展示验证码。&lt;br&gt;话不多说，撸代码：&lt;br&gt;
    
    </summary>
    
      <category term="java &amp; javascript" scheme="http://www.leesj.cn/categories/java-javascript/"/>
    
    
      <category term="javascript" scheme="http://www.leesj.cn/tags/javascript/"/>
    
      <category term="ajax" scheme="http://www.leesj.cn/tags/ajax/"/>
    
      <category term="blob" scheme="http://www.leesj.cn/tags/blob/"/>
    
      <category term="xhr" scheme="http://www.leesj.cn/tags/xhr/"/>
    
      <category term="XMLHttpRequest" scheme="http://www.leesj.cn/tags/XMLHttpRequest/"/>
    
      <category term="验证码" scheme="http://www.leesj.cn/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>JAVA生成简单的图形验证码（上）-- 生成验证码图片</title>
    <link href="http://www.leesj.cn/archives/simple-captcha.html"/>
    <id>http://www.leesj.cn/archives/simple-captcha.html</id>
    <published>2017-06-21T19:21:36.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>JAVA生成简单的图形验证码（上）– 生成验证码图片</p><p>没啥可说的直接上代码了<br><a id="more"></a><br>说明：CaptchaConfig.java这个类是非必须的，其中的配置可以在核心类中写成固定的值</p><h3 id="CaptchaConfig-java-图形的配置"><a href="#CaptchaConfig-java-图形的配置" class="headerlink" title="CaptchaConfig.java ( 图形的配置)"></a>CaptchaConfig.java ( 图形的配置)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptchaConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width = <span class="number">120</span>;    <span class="comment">// 图片的宽度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height = <span class="number">36</span>;    <span class="comment">// 图片的高度</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> length = <span class="number">4</span>;     <span class="comment">// 验证码长度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> fontSize = <span class="number">20</span>;  <span class="comment">// 验证码的字体大小</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CaptchaConfig <span class="title">getDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    <span class="comment">// Getter/Setter省略</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CAPTCHA_CONFIG_PATH = <span class="string">"/captcha.properties"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CaptchaConfig DEFAULT = <span class="keyword">new</span> CaptchaConfig();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取验证码的配置（可要可不要）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(CaptchaConfig.class.getResourceAsStream(CAPTCHA_CONFIG_PATH));</span><br><span class="line">            String h = properties.getProperty(<span class="string">"height"</span>);</span><br><span class="line">            String w = properties.getProperty(<span class="string">"width"</span>);</span><br><span class="line">            String l = properties.getProperty(<span class="string">"length"</span>);</span><br><span class="line">            String fs = properties.getProperty(<span class="string">"font_size"</span>);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(h)) &#123;</span><br><span class="line">                DEFAULT.height = Integer.parseInt(h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(w)) &#123;</span><br><span class="line">                DEFAULT.width = Integer.parseInt(w);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(l)) &#123;</span><br><span class="line">                DEFAULT.length = Integer.parseInt(l);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(fs)) &#123;</span><br><span class="line">                DEFAULT.fontSize = Integer.parseInt(fs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ImageCaptcha-java-生成验证码的核心类"><a href="#ImageCaptcha-java-生成验证码的核心类" class="headerlink" title="ImageCaptcha.java(生成验证码的核心类)"></a>ImageCaptcha.java(生成验证码的核心类)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageCaptcha</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示的字符（为了识别方便，去掉了0和o)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] chars = &#123;</span><br><span class="line">            <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'r'</span>, <span class="string">'s'</span></span><br><span class="line">            , <span class="string">'t'</span>, <span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[] value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CaptchaConfig config;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> startX, startY;     <span class="comment">// 字符起始的位置</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BufferedImage image;    <span class="comment">// 生成的验证码图片对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> created = <span class="keyword">false</span>;    <span class="comment">// 标识验证码是否已经创建</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageCaptcha</span><span class="params">(CaptchaConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">        value = <span class="keyword">new</span> <span class="keyword">char</span>[config.getLength()];</span><br><span class="line">        startX = config.getWidth() / (config.getLength() + <span class="number">2</span>);    <span class="comment">// 每个字的间隔一样</span></span><br><span class="line">        startY = config.getHeight() - (config.getHeight() - config.getFontSize()) / <span class="number">2</span>;   <span class="comment">// 垂直居中</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建图片对象</span></span><br><span class="line">        image = <span class="keyword">new</span> BufferedImage(config.getWidth(), config.getHeight(), BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">// 创建画笔</span></span><br><span class="line">        Graphics2D graphics2D = image.createGraphics();</span><br><span class="line">        <span class="comment">// 设置背景颜色</span></span><br><span class="line">        graphics2D.setColor(Color.lightGray);</span><br><span class="line">        Font font = <span class="keyword">new</span> Font(Font.SANS_SERIF, Font.PLAIN, config.getFontSize());</span><br><span class="line">        <span class="comment">// 设置字体</span></span><br><span class="line">        graphics2D.setFont(font);</span><br><span class="line">        <span class="comment">// 填充矩形</span></span><br><span class="line">        graphics2D.fillRect(<span class="number">0</span>, <span class="number">0</span>, config.getWidth(), config.getHeight());</span><br><span class="line">        <span class="comment">// 绘制干扰线</span></span><br><span class="line">        graphics2D.setColor(Color.black);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> offsetX = random.nextInt(<span class="number">12</span>), offsetY = random.nextInt(<span class="number">12</span>);   <span class="comment">// 干扰线偏移量</span></span><br><span class="line">            <span class="keyword">int</span> x = random.nextInt(config.getWidth());</span><br><span class="line">            <span class="keyword">int</span> y = random.nextInt(config.getHeight());</span><br><span class="line">            graphics2D.drawLine(x, y, x + offsetX, y + offsetY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 绘制验证码</span></span><br><span class="line">        <span class="keyword">int</span> r, g, b;        <span class="comment">// RGB色值，随机的颜色</span></span><br><span class="line">        String temp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; config.getLength(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = randomChar();</span><br><span class="line">            value[i] = c;</span><br><span class="line">            temp = String.valueOf(c);</span><br><span class="line">            r = random.nextInt(<span class="number">255</span>);</span><br><span class="line">            g = random.nextInt(<span class="number">255</span>);</span><br><span class="line">            b = random.nextInt(<span class="number">255</span>);</span><br><span class="line">            graphics2D.setColor(<span class="keyword">new</span> Color(r, g, b));</span><br><span class="line">            graphics2D.drawString(temp, (i + <span class="number">1</span>) * startX, startY);</span><br><span class="line">        &#125;</span><br><span class="line">        created = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到图片的字节流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getImageData() <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        checkState();</span><br><span class="line">        ByteArrayOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            out = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            writeTo(out);</span><br><span class="line">            <span class="keyword">return</span> out.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将图片输出到输出流上</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream 输出流对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 写入图片出错时</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(OutputStream outputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (outputStream == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"输出对象不能为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        checkState();</span><br><span class="line">        ImageIO.write(image, <span class="string">"jpeg"</span>, outputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机的字符</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> chars中的字符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">char</span> <span class="title">randomChar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> chars[random.nextInt(<span class="number">33</span>)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">getImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        checkState();</span><br><span class="line">        <span class="keyword">return</span> image;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCaptchaString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        checkState();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查验证码是否已经创建</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!created) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"验证码未创建,请先调用create方法"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在初始化startY时,还是没搞明白坐标轴是设置的，希望好心人士告知！！！</p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageCaptchaTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateCaptchaTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        CaptchaConfig captchaConfig = CaptchaConfig.getDefault();</span><br><span class="line">        ImageCaptcha captcha = <span class="keyword">new</span> ImageCaptcha(captchaConfig);</span><br><span class="line">        captcha.create();</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"F:/java/captchaTest.jpg"</span>);</span><br><span class="line">        <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">            file.delete();</span><br><span class="line">        &#125;</span><br><span class="line">        file.createNewFile();</span><br><span class="line">        FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        System.out.println(captcha.getCaptchaString());</span><br><span class="line">        captcha.writeTo(outputStream);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="http://blog.csdn.net/chenghui0317/article/details/12526439" target="_blank" rel="noopener">java web项目生成验证码的解决方案</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JAVA生成简单的图形验证码（上）– 生成验证码图片&lt;/p&gt;
&lt;p&gt;没啥可说的直接上代码了&lt;br&gt;
    
    </summary>
    
      <category term="java &amp; javascript" scheme="http://www.leesj.cn/categories/java-javascript/"/>
    
    
      <category term="java" scheme="http://www.leesj.cn/tags/java/"/>
    
      <category term="验证码" scheme="http://www.leesj.cn/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    
      <category term="captcha" scheme="http://www.leesj.cn/tags/captcha/"/>
    
  </entry>
  
  <entry>
    <title>springMVC参数类型转换</title>
    <link href="http://www.leesj.cn/archives/spring-type-converter.html"/>
    <id>http://www.leesj.cn/archives/spring-type-converter.html</id>
    <published>2017-06-21T19:16:33.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p>最近在使用SpringMVC的时候碰到如下问题，故记录下来</p><h3 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a>问题描述：</h3><p>在Controller的方法中接受一个BigDecimal的参数，在JS传一个小数过来时，js端收到的返回码为<a href="http://baike.baidu.com/link?url=JZwlb1NADJQ22oGk4bAYCKurRFfMiBQIoJQRz42yOQpb4tpWjnjDXDOZbJVbi-WRPW2r6_m2mCLYGeHCF-G7Cq" target="_blank" rel="noopener">400(Bad Request)</a><br><a id="more"></a></p><h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h3><p>使用SpringMVC提供的<strong>ServletRequestDataBinder</strong>和<strong>@initBinder</strong>注解<br>在@InitBinder的注解的源码中有如下注释：</p><blockquote><p>Annotation that identifies methods which initialize the<br> {@link org.springframework.web.bind.WebDataBinder} which<br> will be used for populating command and form object arguments of annotated handler methods.</p></blockquote><p>大致的意思是<strong>标识初始化WebDataBinder的方法的注解，其中将用于填充命令和表单对象参数的注释处理程序方法。</strong> ServletRequestDataBinder继承于WebDataBinder，其中<strong>registerCustomEditor</strong>方法用于注册自定义的转换器，转换器的类型为<strong>PropertyEditor</strong>接口，<strong>PropertyEditorSupport</strong>已经实现了该接口，我们只需要复写其中的<strong>setAsText</strong>方法，然后调用<strong>setValue</strong>方法将转换过得值赋给需要的变量。</p><h3 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h3><h3 id="BigDecimalEditor-java"><a href="#BigDecimalEditor-java" class="headerlink" title="BigDecimalEditor.java"></a>BigDecimalEditor.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyEditorSupport;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigDecimalEditor</span> <span class="keyword">extends</span> <span class="title">PropertyEditorSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAsText</span><span class="params">(String text)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text)) &#123;</span><br><span class="line">            setValue(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">double</span> temp = Double.parseDouble(text);</span><br><span class="line">                setValue(BigDecimal.valueOf(temp));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="XXXController-java"><a href="#XXXController-java" class="headerlink" title="XXXController.java"></a>XXXController.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXXController</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/path"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">(BigDecimal someVar)</span></span>&#123;</span><br><span class="line">        System.out.println(someVar);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InitBinder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initWebBinder</span><span class="params">(ServletRequestDataBinder binder)</span> </span>&#123;</span><br><span class="line">        binder.registerCustomEditor(BigDecimal.class, <span class="keyword">new</span> BigDecimalEditor());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如需要转换其他类型，与上述方法类似</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在使用SpringMVC的时候碰到如下问题，故记录下来&lt;/p&gt;
&lt;h3 id=&quot;问题描述：&quot;&gt;&lt;a href=&quot;#问题描述：&quot; class=&quot;headerlink&quot; title=&quot;问题描述：&quot;&gt;&lt;/a&gt;问题描述：&lt;/h3&gt;&lt;p&gt;在Controller的方法中接受一个BigDecimal的参数，在JS传一个小数过来时，js端收到的返回码为&lt;a href=&quot;http://baike.baidu.com/link?url=JZwlb1NADJQ22oGk4bAYCKurRFfMiBQIoJQRz42yOQpb4tpWjnjDXDOZbJVbi-WRPW2r6_m2mCLYGeHCF-G7Cq&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;400(Bad Request)&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://www.leesj.cn/categories/java/"/>
    
    
      <category term="spring" scheme="http://www.leesj.cn/tags/spring/"/>
    
      <category term="java" scheme="http://www.leesj.cn/tags/java/"/>
    
      <category term="springMVC" scheme="http://www.leesj.cn/tags/springMVC/"/>
    
      <category term="类型转换" scheme="http://www.leesj.cn/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/"/>
    
  </entry>
  
  <entry>
    <title>Spring使用quartz配置定时器</title>
    <link href="http://www.leesj.cn/archives/spring-quartz.html"/>
    <id>http://www.leesj.cn/archives/spring-quartz.html</id>
    <published>2017-06-21T18:27:48.000Z</published>
    <updated>2018-07-18T09:20:57.640Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.quartz-scheduler.org/" target="_blank" rel="noopener">quartz</a>是一个强大的开源作业调度框架，支持分布式，这篇文章教会大家如何在spring中配置定时器（分布式配置请移步<a href="http://www.tuicool.com/articles/B3qeUrB" target="_blank" rel="noopener">http://www.tuicool.com/articles/B3qeUrB</a>）。<br><a id="more"></a></p><h3 id="maven配置"><a href="#maven配置" class="headerlink" title="maven配置"></a>maven配置</h3><p>引入quartz的依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="Spring中的配置"><a href="#Spring中的配置" class="headerlink" title="Spring中的配置"></a>Spring中的配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 任务bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"taskObj"</span> <span class="attr">class</span>=<span class="string">"com.example.TaskObj"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 任务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jobDetail"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetObject"</span> <span class="attr">ref</span>=<span class="string">"taskObj"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetMethod"</span> <span class="attr">value</span>=<span class="string">"taskMethod"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 任务触发器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"taskTrigger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"jobDetail"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"startDelay"</span> <span class="attr">value</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span> <span class="attr">value</span>=<span class="string">"0 0 0/1 * * ?"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 任务调度工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"timerFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"triggers"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"taskTrigger"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置说明</p><p>taskObj:    任务所在的实体<br>#<br>jobDetail： 交由quartz管理的任务</p><p>– targetObject:参见taskObj<br>– targetMethod:定时器启动时执行的方法<br>#</p><p>taskTrigger：任务触发器</p><p>– jobDetail:任务<br>– startDelay：延时多少时间执行，默认为0<br>– cronExpression：任务调度的时间表达式，关于这个表达式的格式可参见<a href="http://www.cnblogs.com/yaowen/p/3779284.html" target="_blank" rel="noopener">http://www.cnblogs.com/yaowen/p/3779284.html</a>,若是不理解可以偷懒：<a href="http://cron.qqe2.com/" target="_blank" rel="noopener">在线生成cronExpression</a>。(建议理解后自己写)</p><p>timerFactory：任务调度工厂</p><p>配置完成，赶快去试下效果吧</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://www.quartz-scheduler.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;quartz&lt;/a&gt;是一个强大的开源作业调度框架，支持分布式，这篇文章教会大家如何在spring中配置定时器（分布式配置请移步&lt;a href=&quot;http://www.tuicool.com/articles/B3qeUrB&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.tuicool.com/articles/B3qeUrB&lt;/a&gt;）。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://www.leesj.cn/categories/java/"/>
    
    
      <category term="spring" scheme="http://www.leesj.cn/tags/spring/"/>
    
      <category term="quartz" scheme="http://www.leesj.cn/tags/quartz/"/>
    
      <category term="定时器" scheme="http://www.leesj.cn/tags/%E5%AE%9A%E6%97%B6%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>解决：SpringMVC使用拦截器后ajax无法获取返回的数据</title>
    <link href="http://www.leesj.cn/archives/ajax-response-body.html"/>
    <id>http://www.leesj.cn/archives/ajax-response-body.html</id>
    <published>2017-06-21T18:18:24.000Z</published>
    <updated>2018-07-18T09:20:57.636Z</updated>
    
    <content type="html"><![CDATA[<p>最近在使用SpringMVC时碰到如标题所说的问题，具体原因还未找到，解决办法是采用动态代理的方法（AspectJ），就是常说的AOP，思路来自于<a href="http://www.iteye.com/problems/87048" target="_blank" rel="noopener">http://www.iteye.com/problems/87048</a>中的第一个答案。<br><a id="more"></a><br>解决方法：将拦截器配置为一个动态代理的类,代理@ResponseBody注解的控制器中的方法</p><h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*AspectJ动态代理的注解*/</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request,HttpServletResponse response,Object handler)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// 验证</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 其他实现的方法，这里暂时不需要</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置切面</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"@annotation(org.springframework.web.bind.annotation.ResponseBody)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 引用配置的切面，注意要有返回值</span></span><br><span class="line">    <span class="meta">@Around</span>(value = <span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doAround</span><span class="params">(ProceedingJoinPoint point)</span> </span>&#123;</span><br><span class="line">        Object result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = point.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// 异常处理，也可返回result</span></span><br><span class="line">            result = ....</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Spring配置"><a href="#Spring配置" class="headerlink" title="Spring配置"></a>Spring配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启自动代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspect"</span> <span class="attr">class</span>=<span class="string">"上面的拦截器的类"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>注意：<strong>若Spring主配置文件和SpringMVC的配置文件不在一起，则两个文件都需要配置aspectj的自动代理</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在使用SpringMVC时碰到如标题所说的问题，具体原因还未找到，解决办法是采用动态代理的方法（AspectJ），就是常说的AOP，思路来自于&lt;a href=&quot;http://www.iteye.com/problems/87048&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.iteye.com/problems/87048&lt;/a&gt;中的第一个答案。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://www.leesj.cn/categories/java/"/>
    
    
      <category term="spring" scheme="http://www.leesj.cn/tags/spring/"/>
    
      <category term="ResponseBody" scheme="http://www.leesj.cn/tags/ResponseBody/"/>
    
      <category term="spring拦截器" scheme="http://www.leesj.cn/tags/spring%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    
  </entry>
  
</feed>
